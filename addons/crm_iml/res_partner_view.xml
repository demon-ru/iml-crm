<?xml version="1.0"?>
<openerp>
    <data>
    
	<!-- changed by Alex -->
	<!-- need to clean up all unnecessery tags and keep only search related tags -->
       <record id="view_res_partner_filter_iml_crm1" model="ir.ui.view">
            <field name="name">view.res.partner.select.iml.crm.inherited1</field>
            <field name="model">res.partner</field>
	    <field name="inherit_id" ref="base.view_res_partner_filter"/>
            <field name="arch" type="xml">
			   <!-- changed by Alex -->
			   <field name="category_id" position="replace">
		               	 <field name="category_id" string="Tag" filter_domain="['|', ('category_id', 'ilike', self), ('client_in_service', '=','In Service')]"/>
			   </field>
            </field>
        </record>

        <record id="view_partners_form_iml_crm2" model="ir.ui.view">
        	<field name="name">view.res.partner.form.iml.crm.inherited2</field>
        	<field name="model">res.partner</field>
            <field name="inherit_id" ref="account.partner_view_buttons"/>
            <field eval="18" name="priority"/>
            <field name="arch" type="xml">
            	<data>
					<xpath expr="//div[@name='buttons']/button[@id='invoice_button']" position="replace"/>
					<xpath expr="//div[@name='buttons']/button[@name='%(account.action_account_moves_all_tree)d']" position="replace"/>
					<xpath expr="//div[@name='buttons']/button[@name='%(account.action_open_partner_analytic_accounts)d']/field[@name='contracts_count']" position="replace"/>
					<xpath expr="//div[@name='buttons']/button[@name='%(account.action_open_partner_analytic_accounts)d']" position="inside">
						<field string="Контракты" name="contracts_count" widget="statinfo"/>
					</xpath>
				</data>
			</field>
		</record>


        <record id="view_partners_form_iml_crm1" model="ir.ui.view">
            <field name="name">view.res.partner.form.iml.crm.inherited1</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form"/>
            <field eval="18" name="priority"/>
            <field name="arch" type="xml">
                <data>
                	<field name="parent_id" position="replace">
	                	<field name="parent_id"
	                            placeholder="Company"
	                            domain="[('is_company', '=', True), ('id', '!=', id)]" context="{'default_is_company': True}"
	                            />
                    </field>
                    <xpath expr="//page[@string='Contacts']/field[@name='child_ids']/form[@string='Contact']" position="replace"/>
                    <xpath expr="//page[@string='Contacts']/field[@name='child_ids']" position="inside">
						<form string="Contact">
							<sheet>
								<field name="image" widget='image' class="oe_avatar oe_left" options='{"preview_image": "image_medium"}'/>
								<div class="oe_title">
									<label for="name" class="oe_edit_only"/>
									<h1><field name="name" style="width: 70%%"/></h1>
									<field name="category_id" widget="many2many_tags" placeholder="Tags..." style="width: 70%%"/>
								</div>
								<group>
									<field name="function" placeholder="e.g. Sales Director"/>
									<field name="email"/>
									<field name="phone"/>
									<field name="mobile"/>
								</group>
							</sheet>
						</form>
					</xpath>
                	<xpath expr="//group/group" position="replace"> 
                        <group invisible="True">
		                        <label for="type" attrs="{'invisible': [('parent_id','=', False)]}"/>
		                        <div attrs="{'invisible': [('parent_id','=', False)]}" name="div_type">
		                            <field class="oe_inline" name="type"/>
		                        </div>
		                        <label for="street" string="Address"/>
		                        <div>
		                            <div class="oe_edit_only">
		                                <field name="use_parent_address" class="oe_inline"
		                                       on_change="onchange_address(use_parent_address, parent_id)"
		                                       attrs="{'invisible': ['|', ('is_company', '=', True),('parent_id', '=', False)]}"/>
		                                <label for="use_parent_address" attrs="{'invisible': ['|', ('is_company', '=', True), ('parent_id', '=', False)]}"/>
		                            </div>
		                            <button name="open_parent" type="object" string="(edit company address)" class="oe_link oe_edit_only"
		                                    attrs="{'invisible': ['|',('parent_id','=', False),('use_parent_address','=',False)]}"/>
		                            <field name="street" placeholder="Street..."  attrs="{'readonly': [('use_parent_address','=',True)]}"/>
		                            <field name="street2"  attrs="{'readonly': [('use_parent_address','=',True)]}"/>
		                            <div class="address_format">
		                                <field name="city" placeholder="City" style="width: 40%%" attrs="{'readonly': [('use_parent_address','=',True)]}"/>
		                                <field name="state_id" class="oe_no_button" placeholder="State" style="width: 37%%" options='{"no_open": True}' on_change="onchange_state(state_id)" attrs="{'readonly': [('use_parent_address','=',True)]}"/>
		                                <field name="zip" placeholder="ZIP" style="width: 20%%" attrs="{'readonly': [('use_parent_address','=',True)]}"/>
		                            </div>
		                            <field name="country_id" placeholder="Country" class="oe_no_button" options='{"no_open": True}' attrs="{'readonly': [('use_parent_address','=',True)]}"/>
		                        </div>
                        </group>
                        <group>
		                    <field name="website" widget="url" placeholder="e.g. www.odoo.com" invisible="1"/>
		                </group>
            		</xpath>
            		<xpath expr="//page[@string='Contacts']/field[@name='child_ids']/kanban/templates/t[@t-name='kanban-box']/div/div/div[@class='oe_module_desc']/div/table/tr/td/h4" position="after">
            			<i><div><button name="redirectToContact" type="object">
            				<div>Перейти в карточку</div> </button>
            			</div></i>
            		</xpath>
					<xpath expr="//page[@name='sales_purchases']" position="replace"/>
					<xpath expr="//page[@name='internal_notes']" position="after">
						<page name='sales_purchases' string="Sales &amp; Purchases">
							<group>
								<group>
									<field name="user_id" string="Ответственный" context="{'default_groups_ref': ['base.group_partner_manager']}"/>
									<field name="company_id" string="Подразделение" groups="base.group_multi_company" widget="selection"/>	
								</group>
								<group>
									<field name="customer"/>
									<field name="supplier"/>
								</group>
								<group>
									<field name="active"/>
									<field name='opt_out' string='Исключить из рассылки' />
									<field name='notify_email' string='Принимать сообщения от клиента' widget="radio"/>
								</group>
							</group>
						</page>
					</xpath>
					<field name="function" position="after" >
						<field  name="short_name" invisible="True"/>
						<field  name="unk"/>
						<field  name="juridical_name"/>
						<field name="signer" context="{'show_with_function': True}" attrs="{'invisible': [('is_company','=', False)]}"/>
						<field name="logistics_respons_person" context="{'show_with_function': True}" attrs="{'invisible': [('is_company','=', False)]}"/>
						<field name="financial_resp_per" context="{'show_with_function': True}" attrs="{'invisible': [('is_company','=', False)]}"/>
						<field name="tech_questions" context="{'show_with_function': True}" attrs="{'invisible': [('is_company','=', False)]}"/>
						<group attrs="{'invisible': [('is_company','=', False)]}">
							<field  name="company_org_type"/>
							<field  name="categoryClient_id"/>
							<field string="Состояние обслуживания" name="client_in_service"/>
						</group>
						<group attrs="{'invisible': [('is_company','=', False)]}">
							<field  name="category_of_goods" />
							<field name="website" widget="url" placeholder="e.g. www.odoo.com"/>
						</group>
						<field  name="company_org_type" attrs="{'invisible': [('is_company','=', True)]}"/>
						<field  name="categoryClient_id" attrs="{'invisible': [('is_company','=', True)]}"/>
						<field string="Состояние обслуживания" name="client_in_service" attrs="{'invisible': [('is_company','=', True)]}"/>
						<field  name="category_of_goods" attrs="{'invisible': [('is_company','=', True)]}"/>
						<field name="website" widget="url" placeholder="e.g. www.odoo.com" attrs="{'invisible': [('is_company','=', True)]}"/>
					</field>
					<!-- сокрытие полей контактов для компаний, TaskId = 59 -->
                        <field name="phone" position="replace">
                        	<field name="phone" placeholder="e.g. +32.81.81.37.00" attrs="{'invisible': [('is_company','=', True)]}"/>
                        </field>
                        <field name="mobile" position="replace">
                        	<field name="mobile" attrs="{'invisible': [('is_company','=', True)]}"/>
                        </field>
                        <field name="fax" position="replace">
                        	<field name="fax" attrs="{'invisible': [('is_company','=', True)]}"/>
                        </field>
                        <field name="email" position="replace">
                        	<field name="email" widget="email" attrs="{'required': [('user_ids','!=', [])], 'invisible': [('is_company','=', True)]}"/>
                        </field>
                        <field name="title" domain="[('domain','=','contact')]" options='{"no_open": True}' position="replace">
                        </field>
                        <field name="title" domain="[('domain','=','partner')]" context="{'default_domain': 'partner'}" position="replace">
                            <field name="title" domain="[('domain','=','partner')]" options='{"no_open": True}' attrs="{'invisible': [('is_company','=',True)]}" context="{'default_domain': 'partner'}"/>
                        </field>
                    <!-- закончили сокрытие полей контактов для компаний -->

					<page string="Contacts" position="before">
						<page name='address_info' string= 'Адреса'>
							<group name="juridical_address" String="Юридический адрес">
							<div>
								<div>
									<div class="oe_edit_only">
										<field  name="juridical_address_country"  style="width: 25%%" placeholder="Country.."/>
										<field name="juridical_adress_region" style="width: 25%%" placeholder="Регион.."/>
									</div>
									<div class="oe_edit_only">
										<field  name="juridical_address_city_name" on_change="onchange_adress(juridical_address_index, juridical_address_city_name, juridical_address_street_name, juridical_address_dom, juridical_address_building, juridical_address_office, juridical_adress_non_stand_part, 'juridical_adress_full_adress')" style="width: 25%%" placeholder="City.."/>
										<field  name="juridical_address_index" on_change="onchange_adress(juridical_address_index, juridical_address_city_name, juridical_address_street_name, juridical_address_dom, juridical_address_building, juridical_address_office, juridical_adress_non_stand_part, 'juridical_adress_full_adress')" style="width: 25%%" placeholder="Index.."/>
									</div>
								</div>
								<div class="oe_edit_only">
									<field  name="juridical_address_street_name" on_change="onchange_adress(juridical_address_index, juridical_address_city_name, juridical_address_street_name, juridical_address_dom, juridical_address_building, juridical_address_office, juridical_adress_non_stand_part, 'juridical_adress_full_adress')" style="width: 50%%" placeholder="Street"/>
									<div class="address_format">
										<label name="label_house" string="Дом" />
										<field  name="juridical_address_dom" on_change="onchange_adress(juridical_address_index, juridical_address_city_name, juridical_address_street_name, juridical_address_dom, juridical_address_building, juridical_address_office, juridical_adress_non_stand_part, 'juridical_adress_full_adress')" style="width: 14%%" placeholder="House number"/>
										<label name="label_building" string="Строение"/>
										<field  name="juridical_address_building" on_change="onchange_adress(juridical_address_index, juridical_address_city_name, juridical_address_street_name, juridical_address_dom, juridical_address_building, juridical_address_office, juridical_adress_non_stand_part, 'juridical_adress_full_adress')" style="width: 14%%" placeholder="Building"/>
										<label name="label_office" string="Офис" on_change="onchange_adress(juridical_address_index, juridical_address_city_name, juridical_address_street_name, juridical_address_dom, juridical_address_building, juridical_address_office, juridical_adress_non_stand_part, 'juridical_adress_full_adress')"/>
										<field  name="juridical_address_office" on_change="onchange_adress(juridical_address_index, juridical_address_city_name, juridical_address_street_name, juridical_address_dom, juridical_address_building, juridical_address_office, juridical_adress_non_stand_part, 'juridical_adress_full_adress')" style="width: 13%%" placeholder="Office"/>
									</div>
								</div>
							</div>
							</group>
							<group>
								<div class="oe_edit_only">
									<label name="l_jur_nonestd_adress" string = "Окончание адреса"/>
									<field  name="juridical_adress_non_stand_part" on_change="onchange_adress(juridical_address_index, juridical_address_city_name, juridical_address_street_name, juridical_address_dom, juridical_address_building, juridical_address_office, juridical_adress_non_stand_part, 'juridical_adress_full_adress')"/>
								</div>
							</group>
							<div class="oe_edit_only">
								<label name="l_jur_full_adress" string = "Полный адрес"/>
							</div>
							<field name="juridical_adress_full_adress"  readonly="True"/> 					
							<group String="Фактический адрес">
								<div>
									<div>
										<div class="oe_edit_only">
											<field name="actual_address_country" style="width: 25%%" placeholder="Country.."/>
											<field name="actual_adress_region" style="width: 25%%" placeholder="Регион.."/>
										</div>
										<div class="oe_edit_only">
											<field  name="actual_address_city_name" on_change="onchange_adress(actual_address_index, actual_address_city_name, actual_address_street_name, actual_address_dom, actual_address_building, actual_address_office, actual_adress_non_stand_part, 'actual_adress_full_adress')" style="width: 25%%" placeholder="City.."/>
											<field  name="actual_address_index" on_change="onchange_adress(actual_address_index, actual_address_city_name, actual_address_street_name, actual_address_dom, actual_address_building, actual_address_office, actual_adress_non_stand_part, 'actual_adress_full_adress')" style="width: 25%%" placeholder="Index.."/>
										</div>
									</div>
									<div class="oe_edit_only">
										<field  name="actual_address_street_name" on_change="onchange_adress(actual_address_index, actual_address_city_name, actual_address_street_name, actual_address_dom, actual_address_building, actual_address_office, actual_adress_non_stand_part, 'actual_adress_full_adress')" style="width: 50%%" placeholder="Street"/>
										<div class="address_format">
											<label name="label_house" string="Дом"/>
											<field  name="actual_address_dom" on_change="onchange_adress(actual_address_index, actual_address_city_name, actual_address_street_name, actual_address_dom, actual_address_building, actual_address_office, actual_adress_non_stand_part, 'actual_adress_full_adress')" style="width: 14%%" placeholder="House number"/>
											<label name="label_building" string="Строение"/>
											<field  name="actual_address_building" on_change="onchange_adress(actual_address_index, actual_address_city_name, actual_address_street_name, actual_address_dom, actual_address_building, actual_address_office, actual_adress_non_stand_part, 'actual_adress_full_adress')" style="width: 14%%" placeholder="Building"/>
											<label name="label_office" string="Офис"/>
											<field  name="actual_address_office" on_change="onchange_adress(actual_address_index, actual_address_city_name, actual_address_street_name, actual_address_dom, actual_address_building, actual_address_office, actual_adress_non_stand_part, 'actual_adress_full_adress')" style="width: 13%%" placeholder="Office"/>
										</div>
									</div>
								</div>	
                        	</group>
							<group>	
								<div class="oe_edit_only">
									<label name="l_act_nonestd_adress" string = "Окончание адреса"/>
									<field  name="actual_adress_non_stand_part" on_change="onchange_adress(actual_address_index, actual_address_city_name, actual_address_street_name, actual_address_dom, actual_address_building, actual_address_office, actual_adress_non_stand_part, 'actual_adress_full_adress')"/>
								</div>
							</group>
							<div class="oe_edit_only">
								<label name="l_act_full_adress" string = "Полный адрес"/>
							</div>
							<field name="actual_adress_full_adress" readonly="True"/> 
						</page>
					</page>
					<page name='internal_notes' position="before">
						<page name='bank_info' string= 'Банк' invisible="True">
							<group>
								<field  name="account_number" />
								<field  name="BIN"/>
								<field  name="bank_name"/>
								<field  name="correspondent_account_number"/>
							</group>
						</page>
					</page>
					<page name='internal_notes' position='before'>
						<page name="codes" string= "Коды">
							<group>
								<field  name="type_of_counterparty" />
								<field  name="inn"/>
								<field  name="registration_reason_code"/>
								<field  name="date_of_accounting"/>
								<field  name="OGRN_OGRNIP" />
								<field  name="registration_date"/>
								<field  name="OKVED"/>
								<field  name="OKPO"/>
								<field  name="OKATO"/>
							</group>
						</page>
					</page>
                </data>
            </field>
        </record>
    </data>
</openerp>
