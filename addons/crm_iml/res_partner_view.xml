<?xml version="1.0"?>
<openerp>
    <data>
    
	<!-- changed by Alex -->
       <record id="view_res_partner_filter_iml_crm1" model="ir.ui.view">
            <field name="name">view.res.partner.select.iml.crm.inherited1</field>
            <field name="model">res.partner</field>
	    <field name="inherit_id" ref="base.view_res_partner_filter"/>
            <field name="arch" type="xml">
			   <!-- changed by Alex -->
			   <field name="category_id" position="replace">
		               	 <field name="category_id" string="Tag" filter_domain="['|', ('category_id', 'ilike', self), ('client_in_service', '=','In Service')]"/>
			   </field>
            </field>
        </record>

        <record id="view_partners_form_iml_crm2" model="ir.ui.view">
        	<field name="name">view.res.partner.form.iml.crm.inherited2</field>
        	<field name="model">res.partner</field>
            <field name="inherit_id" ref="account.partner_view_buttons"/>
            <field eval="18" name="priority"/>
            <field name="arch" type="xml">
            	<data>
					<xpath expr="//div[@name='buttons']/button[@id='invoice_button']" position="replace"/>
					<xpath expr="//div[@name='buttons']/button[@name='%(account.action_account_moves_all_tree)d']" position="replace"/>
					<xpath expr="//div[@name='buttons']/button[@name='%(account.action_open_partner_analytic_accounts)d']" position="replace"/>
					<xpath expr="//div[@name='buttons']" position="inside">
						<button class="oe_inline oe_stat_button" type="action" name="%(account.action_open_partner_analytic_accounts)d" icon="fa-book" groups="analytic.group_analytic_accounting" attrs="{'invisible': [('is_company','=', False)]}">
							<field string="Контракты" name="contracts_count" widget="statinfo"/>
						</button>
					</xpath>
				</data>
			</field>
		</record>

		<record id="view_partners_form_iml_crm3" model="ir.ui.view">
			<field name="name">view.res.partner.form.iml.crm.inherited3</field>
			<field name="model">res.partner</field>
			<field name="inherit_id" ref="crm_claim.view_claim_res_partner_info_form"/>
			<field eval="20" name="priority"/>
			<field name="arch" type="xml">
				<data>
					<xpath expr="//div[@name='buttons']/button[@name='%(crm_claim.crm_case_categ_claim0)d']" position="replace" />
					<xpath expr="//div[@name='buttons']" position="inside">
						<button class="oe_inline oe_stat_button" type="action" context="{'search_default_partner_id': active_id, 'default_partner_id':  child_ids}" name="%(crm_claim.crm_case_categ_claim0)d" icon="fa-comments" groups="base.group_sale_salesman">
							<field string="Обращения" name="claim_count" widget="statinfo"/>
                    	</button>
					</xpath>
				</data>
			</field>
		</record>

		<record id="view_partners_form_iml_crm4" model="ir.ui.view">
			<field name="name">view.res.partner.form.iml.crm.inherited4</field>
			<field name="model">res.partner</field>
			<field name="inherit_id" ref="crm.view_partners_form_crm1"/>
			<field eval="20" name="priority"/>
			<field name="arch" type="xml">
				<data>
					<xpath expr="//button[@name='%(crm.crm_case_categ_phone_incoming0)d']" position="replace"/>
					<xpath expr="//div[@name='buttons']" position="inside">
						<button class="oe_inline oe_stat_button" type="action"
                            name="%(crm.crm_case_categ_phone_incoming0)d" 
                            icon="fa-phone"
                            context="{'search_default_partner_id': active_id}">
                            <field string="Звонки" name="phonecall_count" widget="statinfo"/>
						</button>
					</xpath>
				</data>
			</field>
		</record>

        <record id="view_partners_form_iml_crm1" model="ir.ui.view">
            <field name="name">view.res.partner.form.iml.crm.inherited1</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form"/>
            <field eval="18" name="priority"/>
            <field name="arch" type="xml">
                <data>
                	<field name="parent_id" position="replace">
	                	<field name="parent_id"
	                            placeholder="Company"
	                            domain="[('is_company', '=', True), ('id', '!=', id)]" context="{'default_is_company': True}"
	                            />
                    </field>
                	<xpath expr="//group/group" position="replace"> 
                        <group invisible="True">
		                        <label for="type" attrs="{'invisible': [('parent_id','=', False)]}"/>
		                        <div attrs="{'invisible': [('parent_id','=', False)]}" name="div_type">
		                            <field class="oe_inline" name="type"/>
		                        </div>
		                        <label for="street" string="Address"/>
		                        <div>
		                            <div class="oe_edit_only">
		                                <field name="use_parent_address" class="oe_inline"
		                                       on_change="onchange_address(use_parent_address, parent_id)"
		                                       attrs="{'invisible': ['|', ('is_company', '=', True),('parent_id', '=', False)]}"/>
		                                <label for="use_parent_address" attrs="{'invisible': ['|', ('is_company', '=', True), ('parent_id', '=', False)]}"/>
		                            </div>
		                            <button name="open_parent" type="object" string="(edit company address)" class="oe_link oe_edit_only"
		                                    attrs="{'invisible': ['|',('parent_id','=', False),('use_parent_address','=',False)]}"/>
		                            <field name="street" placeholder="Street..."  attrs="{'readonly': [('use_parent_address','=',True)]}"/>
		                            <field name="street2"  attrs="{'readonly': [('use_parent_address','=',True)]}"/>
		                            <div class="address_format">
		                                <field name="city" placeholder="City" style="width: 40%%" attrs="{'readonly': [('use_parent_address','=',True)]}"/>
		                                <field name="state_id" class="oe_no_button" placeholder="State" style="width: 37%%" options='{"no_open": True}' on_change="onchange_state(state_id)" attrs="{'readonly': [('use_parent_address','=',True)]}"/>
		                                <field name="zip" placeholder="ZIP" style="width: 20%%" attrs="{'readonly': [('use_parent_address','=',True)]}"/>
		                            </div>
		                            <field name="country_id" placeholder="Country" class="oe_no_button" options='{"no_open": True}' attrs="{'readonly': [('use_parent_address','=',True)]}"/>
		                        </div>
                        </group>
                        <group>
		                    <field name="website" widget="url" placeholder="e.g. www.odoo.com" invisible="1"/>
		                </group>
            		</xpath>
					<xpath expr="//page[@name='sales_purchases']" position="replace"/>
					<xpath expr="//page[@name='internal_notes']" position="after">
						<page name='sales_purchases' string="Sales &amp; Purchases" attrs="{'invisible': [('is_company','=', False)]}">
							<group>
								<group>
									<field name="user_id" string="Ответственный" context="{'default_groups_ref': ['base.group_partner_manager']}"/>
									<field name="company_id" string="Подразделение" groups="base.group_multi_company" widget="selection"/>	
								</group>
								<group>
									<field name="customer"/>
									<field name="supplier"/>
								</group>
								<group>
									<field name="active"/>
									<field name='opt_out' string='Исключить из рассылки' />
									<field name='notify_email' string='Принимать сообщения от клиента' widget="radio"/>
								</group>
							</group>
						</page>
					</xpath>
					<field name="function" position="before">
						<field name="surname" attrs="{'invisible': [('is_company','=', True)]}" on_change="onchange_fio(surname, firstname, patronymic)" />
						<field name="firstname" attrs="{'invisible': [('is_company','=', True)]}" on_change="onchange_fio(surname, firstname, patronymic)"/>
						<field name="patronymic" attrs="{'invisible': [('is_company','=', True)]}" on_change="onchange_fio(surname, firstname, patronymic)"/>
					</field>
					<field name="function" position="after" >
						<field  name="unk" attrs="{'invisible': [('is_company','=', False)]}"/>
						<field  name="company_org_type" attrs="{'invisible': True}"/>
						<field  name="juridical_name" attrs="{'invisible': [('is_company','=', False)]}"/>
						<field name="first_contact" context="{'show_with_function': True}" options='{"always_reload": True}' attrs="{'invisible': [('is_company','=', False)]}"/>
						<field name="signer" context="{'show_with_function': True}" attrs="{'invisible': [('is_company','=', False)]}" options='{"always_reload": True}'/>
						<field name="logistics_respons_person" context="{'show_with_function': True}" attrs="{'invisible': [('is_company','=', False)]}" options='{"always_reload": True}'/>
						<field name="financial_resp_per" context="{'show_with_function': True}" attrs="{'invisible': [('is_company','=', False)]}" options='{"always_reload": True}'/>
						<field name="tech_questions" context="{'show_with_function': True}" attrs="{'invisible': [('is_company','=', False)]}" options='{"always_reload": True}'/>
						<group attrs="{'invisible': [('is_company','=', False)]}">
							<field  name="categoryClient_id"/>
							<field string="Состояние обслуживания" name="client_in_service"/>
						</group>
						<group attrs="{'invisible': [('is_company','=', False)]}">
							<field  name="category_of_goods" />
							<field name="website" widget="url" placeholder="e.g. www.odoo.com"/>
						</group>
						<field  name="short_name" invisible="True"/>
					</field>
					<!-- сокрытие полей контактов для компаний, TaskId = 59 -->
                        <field name="phone" position="replace">
                        	<field name="phone" placeholder="e.g. +32.81.81.37.00" attrs="{'invisible': [('is_company','=', True)]}"/>
                        </field>
                        <field name="mobile" position="replace">
                        	<field name="mobile" attrs="{'invisible': [('is_company','=', True)]}"/>
                        </field>
                        <field name="fax" position="replace">
                        	<field name="fax" attrs="{'invisible': [('is_company','=', True)]}"/>
                        </field>
                        <field name="email" position="replace">
                        	<field name="email" widget="email" attrs="{'required': [('user_ids','!=', [])], 'invisible': [('is_company','=', True)]}"/>
                        </field>
                        <field name="title" domain="[('domain','=','contact')]" options='{"no_open": True}' position="replace">
                        </field>
                        <field name="title" domain="[('domain','=','partner')]" context="{'default_domain': 'partner'}" position="replace">
                        </field>
                    <!-- закончили сокрытие полей контактов для компаний -->
                    <field name="unk" position="after">
						<field name="title" domain="[('domain','=','partner')]" options='{"no_open": True}' attrs="{'invisible': [('is_company','=',False)]}" context="{'default_domain': 'partner'}"/>
					</field>
					<xpath expr="//page[@string='Contacts']" position="replace"/>
					<xpath expr="//notebook/page[@name='internal_notes']" position="before">
						<page string="Contacts" attrs="{'invisible': [('is_company','=',False)]}">
							<field name="child_ids"  widget="many2many_kanban" domain="[('is_company', '=', False),('parent_id','=', False)]" context="{'default_parent_id': active_id, 'default_street': street, 'default_street2': street2, 'default_city': city, 'default_state_id': state_id, 'default_zip': zip, 'default_country_id': country_id, 'default_supplier': supplier, 'default_customer': customer, 'default_use_parent_address': True}">
								<kanban>
								    <field name="color"/>
								    <field name="name"/>
								    <field name="title"/>
								    <field name="email"/>
								    <field name="parent_id"/>
								    <field name="is_company"/>
								    <field name="function"/>
								    <field name="phone"/>
								    <field name="street"/>
								    <field name="street2"/>
								    <field name="zip"/>
								    <field name="city"/>
								    <field name="country_id"/>
								    <field name="mobile"/>
								    <field name="fax"/>
								    <field name="state_id"/>
								    <field name="has_image"/>
								    <templates>
								        <t t-name="kanban-box">
								            <t t-set="color" t-value="kanban_color(record.color.raw_value)"/>
								            <div t-att-class="color + (record.title.raw_value == 1 ? ' oe_kanban_color_alert' : '')" style="position: relative">
								                <a t-if="! read_only_mode" type="delete" style="position: absolute; right: 0; padding: 4px; diplay: inline-block">X</a>
								                <div class="oe_module_vignette">
								                <a type="open">
								                    <t t-if="record.has_image.raw_value === true">
								                        <img t-att-src="kanban_image('res.partner', 'image', record.id.value, {'preview_image': 'image_small'})" class="oe_avatar oe_kanban_avatar_smallbox"/>
								                    </t>
								                    <t t-if="record.image and record.image.raw_value !== false">
								                        <img t-att-src="'data:image/png;base64,'+record.image.raw_value" class="oe_avatar oe_kanban_avatar_smallbox"/>
								                    </t>
								                    <t t-if="record.has_image.raw_value === false and (!record.image or record.image.raw_value === false)">
								                        <t t-if="record.is_company.raw_value === true">
								                            <img t-att-src='_s + "/base/static/src/img/company_image.png"' class="oe_kanban_image oe_kanban_avatar_smallbox"/>
								                        </t>
								                        <t t-if="record.is_company.raw_value === false">
								                            <img t-att-src='_s + "/base/static/src/img/avatar.png"' class="oe_kanban_image oe_kanban_avatar_smallbox"/>
								                        </t>
								                    </t>
								                </a>
								                    <div class="oe_module_desc">
								                        <div class="oe_kanban_box_content oe_kanban_color_bglight oe_kanban_color_border">
								                            <table class="oe_kanban_table">
								                                <tr>
								                                    <td class="oe_kanban_title1" align="left" valign="middle">
								                                        <h4>
								                                        	<a type="open"><field name="name"/></a>
								                                        </h4>
								                                        <i><div><button name="redirectToContact" type="object">
        																<div>Перейти в карточку</div> </button>
        																</div></i>
								                                        <i><div t-if="record.function.raw_value">
								                                            <field name="function"/></div></i>
								                                        <div><a t-if="record.email.raw_value" title="Mail" t-att-href="'mailto:'+record.email.value">
								                                            <field name="email"/>
								                                        </a></div>
								                                        <div t-if="record.phone.raw_value">Phone: <field name="phone"/></div>
								                                        <div t-if="record.mobile.raw_value">Mobile: <field name="mobile"/></div>
								                                        <div t-if="record.fax.raw_value">Fax: <field name="fax"/></div>
								                                    </td>
								                                </tr>
								                            </table>
								                        </div>
								                    </div>
								                </div>
								            </div>
								        </t>
								    </templates>
								</kanban>
								<form string="Contact">
									<sheet>
										<field name="image" widget='image' class="oe_avatar oe_left" options='{"preview_image": "image_medium"}'/>
										<div class="oe_title">
											<label for="name" class="oe_edit_only"/>
											<h1><field name="name" style="width: 70%%"/></h1>
											<field name="category_id" widget="many2many_tags" placeholder="Tags..." style="width: 70%%"/>
										</div>
										<group>
											<field name="function" placeholder="e.g. Sales Director"/>
											<field name="email"/>
											<field name="phone"/>
											<field name="mobile"/>
										</group>
									</sheet>
								</form>
							</field>
						</page>
					</xpath>
					<page string="Contacts" position="before">
						<page name='address_info' string= 'Адреса' attrs="{'invisible': [('is_company','=', False)]}">
							<group name="juridical_address" String="Юридический адрес">
							<div>
								<div>
									<div class="oe_edit_only">
										<field  name="juridical_address_country"  style="width: 25%%" placeholder="Country.."/>
										<field name="juridical_adress_region" style="width: 25%%" placeholder="Регион.."/>
									</div>
									<div class="oe_edit_only">
										<field  name="juridical_address_city_name" on_change="onchange_adress(juridical_address_index, juridical_address_city_name, juridical_address_street_name, juridical_address_dom, juridical_address_building, juridical_address_office, juridical_adress_non_stand_part, 'juridical_adress_full_adress')" style="width: 25%%" placeholder="City.."/>
										<field  name="juridical_address_index" on_change="onchange_adress(juridical_address_index, juridical_address_city_name, juridical_address_street_name, juridical_address_dom, juridical_address_building, juridical_address_office, juridical_adress_non_stand_part, 'juridical_adress_full_adress')" style="width: 25%%" placeholder="Index.."/>
									</div>
								</div>
								<div class="oe_edit_only">
									<field  name="juridical_address_street_name" on_change="onchange_adress(juridical_address_index, juridical_address_city_name, juridical_address_street_name, juridical_address_dom, juridical_address_building, juridical_address_office, juridical_adress_non_stand_part, 'juridical_adress_full_adress')" style="width: 50%%" placeholder="Street"/>
									<div class="address_format">
										<label name="label_house" string="Дом" />
										<field  name="juridical_address_dom" on_change="onchange_adress(juridical_address_index, juridical_address_city_name, juridical_address_street_name, juridical_address_dom, juridical_address_building, juridical_address_office, juridical_adress_non_stand_part, 'juridical_adress_full_adress')" style="width: 14%%" placeholder="House number"/>
										<label name="label_building" string="Строение"/>
										<field  name="juridical_address_building" on_change="onchange_adress(juridical_address_index, juridical_address_city_name, juridical_address_street_name, juridical_address_dom, juridical_address_building, juridical_address_office, juridical_adress_non_stand_part, 'juridical_adress_full_adress')" style="width: 14%%" placeholder="Building"/>
										<label name="label_office" string="Офис" on_change="onchange_adress(juridical_address_index, juridical_address_city_name, juridical_address_street_name, juridical_address_dom, juridical_address_building, juridical_address_office, juridical_adress_non_stand_part, 'juridical_adress_full_adress')"/>
										<field  name="juridical_address_office" on_change="onchange_adress(juridical_address_index, juridical_address_city_name, juridical_address_street_name, juridical_address_dom, juridical_address_building, juridical_address_office, juridical_adress_non_stand_part, 'juridical_adress_full_adress')" style="width: 13%%" placeholder="Office"/>
									</div>
								</div>
							</div>
							</group>
							<group>
								<div class="oe_edit_only">
									<label name="l_jur_nonestd_adress" string = "Окончание адреса"/>
									<field  name="juridical_adress_non_stand_part" on_change="onchange_adress(juridical_address_index, juridical_address_city_name, juridical_address_street_name, juridical_address_dom, juridical_address_building, juridical_address_office, juridical_adress_non_stand_part, 'juridical_adress_full_adress')"/>
								</div>
							</group>
							<div class="oe_edit_only">
								<label name="l_jur_full_adress" string = "Полный адрес"/>
							</div>
							<field name="juridical_adress_full_adress"  readonly="True"/> 					
							<group String="Фактический адрес">
								<div>
									<div>
										<div class="oe_edit_only">
											<field name="actual_address_country" style="width: 25%%" placeholder="Country.."/>
											<field name="actual_adress_region" style="width: 25%%" placeholder="Регион.."/>
										</div>
										<div class="oe_edit_only">
											<field  name="actual_address_city_name" on_change="onchange_adress(actual_address_index, actual_address_city_name, actual_address_street_name, actual_address_dom, actual_address_building, actual_address_office, actual_adress_non_stand_part, 'actual_adress_full_adress')" style="width: 25%%" placeholder="City.."/>
											<field  name="actual_address_index" on_change="onchange_adress(actual_address_index, actual_address_city_name, actual_address_street_name, actual_address_dom, actual_address_building, actual_address_office, actual_adress_non_stand_part, 'actual_adress_full_adress')" style="width: 25%%" placeholder="Index.."/>
										</div>
									</div>
									<div class="oe_edit_only">
										<field  name="actual_address_street_name" on_change="onchange_adress(actual_address_index, actual_address_city_name, actual_address_street_name, actual_address_dom, actual_address_building, actual_address_office, actual_adress_non_stand_part, 'actual_adress_full_adress')" style="width: 50%%" placeholder="Street"/>
										<div class="address_format">
											<label name="label_house" string="Дом"/>
											<field  name="actual_address_dom" on_change="onchange_adress(actual_address_index, actual_address_city_name, actual_address_street_name, actual_address_dom, actual_address_building, actual_address_office, actual_adress_non_stand_part, 'actual_adress_full_adress')" style="width: 14%%" placeholder="House number"/>
											<label name="label_building" string="Строение"/>
											<field  name="actual_address_building" on_change="onchange_adress(actual_address_index, actual_address_city_name, actual_address_street_name, actual_address_dom, actual_address_building, actual_address_office, actual_adress_non_stand_part, 'actual_adress_full_adress')" style="width: 14%%" placeholder="Building"/>
											<label name="label_office" string="Офис"/>
											<field  name="actual_address_office" on_change="onchange_adress(actual_address_index, actual_address_city_name, actual_address_street_name, actual_address_dom, actual_address_building, actual_address_office, actual_adress_non_stand_part, 'actual_adress_full_adress')" style="width: 13%%" placeholder="Office"/>
										</div>
									</div>
								</div>	
                        	</group>
							<group>	
								<div class="oe_edit_only">
									<label name="l_act_nonestd_adress" string = "Окончание адреса"/>
									<field  name="actual_adress_non_stand_part" on_change="onchange_adress(actual_address_index, actual_address_city_name, actual_address_street_name, actual_address_dom, actual_address_building, actual_address_office, actual_adress_non_stand_part, 'actual_adress_full_adress')"/>
								</div>
							</group>
							<div class="oe_edit_only">
								<label name="l_act_full_adress" string = "Полный адрес"/>
							</div>
							<field name="actual_adress_full_adress" readonly="True"/> 
						</page>
					</page>
					<page name='internal_notes' position="before">
						<page name='bank_info' string= 'Банк' invisible="True">
							<group>
								<field  name="account_number" />
								<field  name="BIN"/>
								<field  name="bank_name"/>
								<field  name="correspondent_account_number"/>
							</group>
						</page>
					</page>
					<page name='internal_notes' position='before'>
						<page name="codes" string= "Коды" attrs="{'invisible': [('is_company','=', False)]}">
							<group>
								<field  name="type_of_counterparty" />
								<field  name="inn"/>
								<field  name="registration_reason_code"/>
								<field  name="date_of_accounting"/>
								<field  name="OGRN_OGRNIP" />
								<field  name="registration_date"/>
								<field  name="OKVED"/>
								<field  name="OKPO"/>
								<field  name="OKATO"/>
							</group>
						</page>
					</page>
                </data>
            </field>
        </record>

        <record id="view_partner_title_tree_crm_iml_mod" model="ir.ui.view">
            <field name="name">res.partner.title.tree.inherited1</field>
            <field name="model">res.partner.title</field>
			<field name="inherit_id" ref="base.view_partner_title_tree"/>
			<field eval="20" name="priority"/>
			<field name="arch" type="xml">
					<tree position="replace">
	                    <tree string="Partner Titles">
		                    <field name="name"/>
		                    <field name="shortcut"/>
		                    <field name="ext_code"/>
		                </tree>
	                </tree>
			</field>
		</record>


        <record id="view_partner_title_form_crm_iml_mod" model="ir.ui.view">
            <field name="name">res.partner.title.form.crm.iml.mod</field>
            <field name="model">res.partner.title</field>
			<field name="inherit_id" ref="base.view_partner_title_form"/>
			<field eval="20" name="priority"/>
			<field name="arch" type="xml">
				<data>
                    <field name="domain" position="after">
                    	<field name="ext_code"/>
                    </field>
				</data>
			</field>
		</record>



    </data>
</openerp>
