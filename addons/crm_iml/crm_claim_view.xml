<?xml version="1.0"?>
<openerp>
	<data>

	<record id="view_crm_claim_iml_crm" model="ir.ui.view">
			<field name="name">view.crm.claim.form.iml.crm.inherited</field>
		<field name="model">crm.claim</field>
		<field name="inherit_id" ref="crm_claim.crm_case_claims_form_view"/>
		<field eval="18" name="priority"/>
		<field name="arch" type="xml">
				<field name="stage_id" position="replace">
					<field name="stage_id" widget="statusbar" clickable="True"
					 options="{'fold_field': 'fold'}"
					 on_change="onchange_stage_id(stage_id)"/>
				</field>
				<xpath expr="//page[@string='Claim Description']" position="replace"/>
				<xpath expr="//group/field[@name='priority']" position="replace" />
				<xpath expr="//group/field[@name='date_deadline']" position="replace" />
				<xpath expr="//group/field[@name='user_id']" position="after">
					<field name="date_deadline"/>
				</xpath>
				<xpath expr="//group/field[@name='section_id']" position="after">
					<field name="priority" widget="priority"/>
					<field name="categ_id" options="{'no_create': True, 'no_open': True}" domain="[('object_id.model', '=', 'crm.claim')]"/>
				</xpath>
				<xpath expr="//page[@string='Follow Up']" position="before">
					<page string="Описание обрашения">
						<group colspan="2" col="2" groups="base.group_user">
							<separator colspan="2" string="Обратившееся лицо"/>
							<field name="partner_id" string="Partner" on_change="onchange_partner_id(partner_id)"/>
							<field name="partner_phone"/>
							<field name="email_from" widget="email"/>
						</group>
						<separator colspan="4" string="Описание" groups="base.group_user"/>
						<field name="description" colspan="4" nolabel="1"/>
					</page>
				</xpath>
			</field>
		</record>


		<!-- Claim Stages -->

		<record id="crm_claim_stage_tree_crm_iml" model="ir.ui.view">
			<field name="name">crm.claim.stage.tree.inherited.crm.iml</field>
			<field name="model">crm.claim.stage</field>
			<field name="inherit_id" ref="crm_claim.crm_claim_stage_tree"/>
			<field name="arch" type="xml">
				<tree string="Claim Stages">
					<field name="is_terminate"/>
				</tree>
			</field>
		</record>

		<record id="crm_claim_stage_form_crm_iml" model="ir.ui.view">
			<field name="name">crm.claim.stage.form.inherited.crm.iml</field>
			<field name="model">crm.claim.stage</field>
			<field name="inherit_id" ref="crm_claim.crm_claim_stage_form"/>
			<field name="arch" type="xml">
				<form string="Claim Stage">
					<group col="4">
						<field name="is_terminate"/>
					</group>
				</form>
			</field>
		</record>

        <!-- CRM Claim Kanban View  -->
        <record model="ir.ui.view" id="crm_iml_claim_kanban_view">
            <field name="name">CRM-Claim Kanban</field>
            <field name="model">crm.claim</field>
            <field name="arch" type="xml">
                <kanban default_group_by="stage_id" >
                    <field name="color"/>
                    <field name="priority"/>
                    <field name="user_id"/>
                    <field name="stage_id"/>
                    <field name="date_deadline"/>
                    <templates>
                        <field name="date_deadline"/>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_color_#{kanban_getcolor(record.color.raw_value)} oe_kanban_card oe_kanban_global_click">
                                <div class="oe_dropdown_toggle oe_dropdown_kanban">
                                    <span class="oe_e">í</span>
                                    <ul class="oe_dropdown_menu">
                                        <t t-if="widget.view.is_action_enabled('edit')"><li><a type="edit">Редактировать...</a></li></t>
                                        <t t-if="widget.view.is_action_enabled('delete')"><li><a type="delete">Удалить</a></li></t>
                                    </ul>
                                </div>
                                <div class="oe_kanban_content">
                                    <div>
                                        <b><field name="name"/></b>
                                    </div>
                                    <div>
                                        <field name="partner_id"/>
                                    </div>
                                    <div style="padding-left: 0.5em">
                                        <t t-if="record.date_deadline.raw_value and record.date_deadline.raw_value lt (new Date())" t-set="red">oe_kanban_text_red</t>
                                        <span t-attf-class="#{red || ''}"><field name="date_action_next"/></span>
                                        <t t-if="record.date_action_next.raw_value"> : </t>
                                        <field name="action_next"/>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <img t-att-src="kanban_image('res.users', 'image_small', record.user_id.raw_value)" t-att-title="record.user_id.value" width="24" height="24" class="oe_kanban_avatar pull-right"/>
                                        <div class="pull-left" groups="base.group_user">
                                            <field name="priority" widget="priority"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="oe_clear"></div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

	    <record model="ir.actions.act_window.view" id="action_crm_tag_kanban_view_claim">
	        <field name="sequence" eval="0"/>
	        <field name="view_mode">kanban</field>
	        <field name="view_id" ref="crm_iml_claim_kanban_view"/>
	        <field name="act_window_id" ref="crm_claim.crm_case_categ_claim0"/>
	    </record>

	    <!-- Claims Menu -->
        <record model="ir.actions.act_window" id="crm_claim.crm_case_categ_claim0">
            <field name="name">Claims</field>
            <field name="res_model">crm.claim</field>
            <field name="view_type">form</field>
            <field name="view_mode">kanban,tree,calendar,form</field>
            <field name="view_id" eval="False"/>
            <field name="context">{"search_default_user_id":uid, "stage_type":'claim'}</field>
            <field name="search_view_id" ref="crm_claim.view_crm_case_claims_filter"/>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Record and track your customers' claims. Claims may be linked to a sales order or a lot.You can send emails with attachments and keep the full history for a claim (emails sent, intervention type and so on).Claims may automatically be linked to an email address using the mail gateway module.
                </p>
            </field>
        </record>

	</data>
</openerp>
